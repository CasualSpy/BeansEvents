CREATE TABLE `events` (
  `id` integer AUTO_INCREMENT PRIMARY KEY,
  `title` varchar(255) NOT NULL,
  `location` varchar(255),
  `description` text,
  `created_by` integer NOT NULL,
  `start_time` timestamp DEFAULT CURRENT_TIMESTAMP,
  `end_time` timestamp DEFAULT CURRENT_TIMESTAMP,
  `status` ENUM ('pending', 'cancelled', 'confirmed') DEFAULT 'pending',
  `date_created` timestamp DEFAULT CURRENT_TIMESTAMP,
  `date_modified` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE `users` (
  `id` integer AUTO_INCREMENT PRIMARY KEY,
  `email` varchar(255) NOT NULL UNIQUE,
  `username` varchar(255) NOT NULL UNIQUE,
  `fullname` varchar(255),
  `role` ENUM ('base', 'admin') DEFAULT 'base',
  `password_hash` varchar(255) NOT NULL,
  `password_salt` varchar(255) NOT NULL,
  `date_created` timestamp DEFAULT CURRENT_TIMESTAMP,
  `date_modified` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

CREATE TABLE `responses` (
  `id` integer AUTO_INCREMENT PRIMARY KEY,
  `event_id` integer NOT NULL,
  `user_id` integer NOT NULL,
  `answer` ENUM ('going', 'not_going'),
  `date_created` timestamp DEFAULT CURRENT_TIMESTAMP,
  `date_modified` timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

ALTER TABLE `events` ADD FOREIGN KEY (`created_by`) REFERENCES `users` (`id`);

ALTER TABLE `responses` ADD FOREIGN KEY (`user_id`) REFERENCES `users` (`id`);

ALTER TABLE `responses` ADD FOREIGN KEY (`event_id`) REFERENCES `events` (`id`);

ALTER TABLE `responses` ADD UNIQUE `unique_index`(`event_id`, `user_id`);
